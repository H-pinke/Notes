##### 为什么要使用Redis?

项目中使用的人越来越多，只使用传统的关系型数据库（如：mysql）已经不能满足项目的需求。出于对项目的**性能**和**并发**方面的考虑，需要在项目中引入缓存中间件。当时综合比较了常用的缓存中间件Redis和Memcache的优缺点之后，最终决定选择使用Redis

##### 说说Redis都有哪些数据类型？

Redis 支持多种类型的数据结构，常用的有5种，分别是string（字符串），hash（哈希），list（列表），set（集合）及zset(sorted set：有序集合)。如果你想要突出自己，还需要加上下面几种数据结构bitmaps, hyperloglogs, geospatial indexes ，streams 回答到这里，基本就达到让面试官睁眼的水平了

##### 小伙子，那你知道Redis String的底层实现方式吗？

字符串对象底层数据结构实现为 简单动态字符串（SDS）和直接存储。（注：SDS 是一个redis 定义的结构体）

##### Redis的持久化了解么？请简单介绍一下

Redis 持久化有两种， RDB和AOF

RDB:做全量持久化（Redis默认的持久化方式）。按照一定的时间周期策略把内存的数据以快照的形式保存到硬盘的二进制文件。对应产生的数据文件为dump.rdb，通过配置文件中的save参数来定义快照的周期（快照可以是其所表示的数据的一个副本，也可以是数据的一个复制品）

AOF：做增量的持久化：Redis会将每一个收到的写命令都通过write函数追加到文件的最后，类似于Mysql的binlog。必要时，可以通过重新执行文件中保存的写命令来在内存中重建整个redis数据库

Redis本身的机制是：当AOF 持久化开启且存在AOF文件时，优先加载AOF文件。当AOF持久化关闭或不存在AOF文件时，加载RDB文件。加载AOF/RDB 文件成功之后，Redis启动成功。如果AOF/RDB 文件存在错误，则Redis启动失败并打印错误信息

##### 了解Pipeline吗？请简单介绍一下

可以将多条命令一起打包发送至redis处理，处理完成后，将处理结果按照顺序打包，一起返回。好处是可以减少I/O次数。提升redis吞吐量。不过有两点需要注意：一个pipeline中的命令互相之间不能有因果关系。另外，一个pipeline中的命令不宜过多，不然数据量过大，增加客户端的等待时间，还可能造成网络阻塞。可以将大量命令的拆分多个小的pipeline命令完成

##### 那你使用过Redis分布式锁吗？怎么实现

先使用setnx争抢锁，抢到之后使用expire给锁加一个过期时间，防止忘记释放锁

##### 那如果在执行setnx之后，执行expire之前进程意外crash或者要重启维护了，会怎么样？

set命令后面可以加参数，实现加锁和设置过期时间两个操作，保证操作原子性。（命令 set key value EX second Nx）

##### 使用过redis做异步队列吗？讲解一下实现方式

一般使用list结构做队列，lpush生产消息，rpop消费消息，当rpop没有消息的时候，适当的sleep一会儿再重试

##### 面试官再问，可不可以不用sleep呢

可以，使用list结构中的阻塞指令，如brpop。在列表没有元素时，会阻塞列表直到等待超时或发现可弹出元素为止。

##### 面试官追问，如果我想生产一次，消费多次呢

可以使用pub/sub发布订阅模式，实现 1:N 的消息队列

##### 再追问，pub/sub 模式有什么缺点？

在消费者下线的情况下，生产的消费会丢失。可以使用专业的消息队列保证消息不丢失，如rocketMQ, rabbitMQ等

##### 再再再追问，Redis如何实现延时队列？

使用 sortedset ,用时间戳作为 score，消息内容作为key，生产者调用zadd生产消息，消费者用 zrangbyscore指令获取N秒之前的消息，轮询进程处理

##### Redis 事务了解吗？如果事务中有某条/某些命令 执行失败了会怎么样呢？

事务中的某条命令执行失败了，事务中的其他指令依然会继续执行。另外，Redis事务不支持 roolback

##### 假如Redis里面有1亿个key，其中有10W个key是以某个固定的已知的前缀开头的，如何将他们找出来

使用keys指令可以扫出指定模式的key列表

##### 如果这个redis正在给线上的业务提供服务，那使用keys指令会有什么问题？

这个时候你要回答，redis关键的一个特性：redis是单线程的。roolback keys指令会导致线程阻塞一段时间，线上服务会停顿，直到指令执行完毕，服务才能恢复。这个时候可以使用 scan指令，scan指令可以无阻塞的提取出指定模式的key列表，但是key可能会有一定的重复，在客户端做一次去重就可以了。scan整体所花费的时间会比用keys指令长。

##### Mysql里面2000w数据，redis中只能存20W的数据，如何保证redis中的数据都是热点数据

当客户端往Redis添加了新的数据后。Redis会检查内存使用情况，如果大于maxmemory的限制，则根据设定好的淘汰策略对旧数据进行回收。

##### 使用过Redis 集群吗，集群的高可用怎么保证，集群的原理是什么？

Redis Sentinal（哨兵）着眼于高可用，在master宕机时会自动将slave提升为master。继续提供服务。

Redis Cluster(集群) 着眼于扩展性，在单个redis内存不足时，使用Cluster进行分片存储。

##### 说说Redis集群的数据分片

Redis集群没有使用一致性hash，而是引入了哈希槽点概念。Redis集群有16384个哈希槽，每个key通过CRC16校验后对16384取模来决定放置哪个槽，集群的每个节点负责一部分hash槽。

